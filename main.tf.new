resource "azurerm_monitor_diagnostic_setting" "session_hosts" {
  count                      = var.enable_monitoring ? var.session_host_count : 0
  name                       = "diag-${azurerm_windows_virtual_machine.session_host[count.index].name}"
  target_resource_id         = azurerm_windows_virtual_machine.session_host[count.index].id
  log_analytics_workspace_id = azurerm_log_analytics_workspace.avd_monitoring[0].id

  metric {
    category = "AllMetrics"
    enabled  = true
  }
}